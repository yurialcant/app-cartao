name: CI

on:
  push:
    branches: [ main, master ]
  pull_request:

jobs:
  build-java:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '17'
          cache: 'maven'
      - name: Build Java services
        run: |
          for dir in services/*; do
            if [ -f "$dir/pom.xml" ]; then
              echo "Building $dir";
              (cd "$dir" && mvn -B -DskipTests package);
            fi
          done

  build-angular:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
      - name: Build Admin Angular
        working-directory: apps/admin_angular
        run: |
          npm ci
          npm run build --if-present
      - name: Build Employer Portal Angular
        working-directory: apps/employer_portal_angular
        run: |
          npm ci
          npm run build --if-present
      - name: Build Merchant Portal Angular
        working-directory: apps/merchant_portal_angular
        run: |
          npm ci
          npm run build --if-present
